services:
  mcp-service:
    build:
      context: ../../
      dockerfile: ./docker/nginx/Dockerfile.mcp
    container_name: trend-radar-mcp
    volumes:
      - ../config:/app/config:ro
      - ../output:/app/output:ro
    ports:
      - "127.0.0.1:3333:3333"
    environment:
      - LISTEN_ADDR=0.0.0.0
      - LISTEN_PORT=3333
      - TZ=Asia/Shanghai
    restart: always
    networks:
      - mcp-network

  # 2. Nginx 代理（对外暴露 80/443 端口，接收远程请求）
  nginx-proxy:
    image: nginx
    container_name: nginx-proxy
    ports:
      - "80:80"
    restart: always
    volumes:
      - ./default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - mcp-service
    networks:
      - mcp-network

networks:
  mcp-network:
    driver: bridge